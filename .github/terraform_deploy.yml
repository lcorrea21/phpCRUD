name: Terraform Deployment

on:
  workflow_run:
    workflows: [ Build Application ]
    types: [ completed ]
    branches:
      - main
      - 'feature/**'
  workflow_dispatch: #this attribute will enable the manual run to the pipeline


load_variables:
    runs-on: ubuntu-latest

    steps:
      - name: Github Object
        run: echo ${{ toJson(github) }} 
    
      - name: Get branch name (main)
        if: |
          (github.event.workflow_run.event == 'pull_request' || github.event.workflow_run.event == 'push' || github.event_name == 'workflow_dispatch')  &&
          github.ref == 'refs/heads/main'
        shell: bash
        run: echo "BRANCH_NAME=$(echo ${GITHUB_REF#refs/heads/} | tr [:upper:] [:lower:] | tr /_ - | cut -d "-" -f 2-3)" >> $GITHUB_ENV

      - name: Get branch name other branch
        if: |
          (github.event.workflow_run.event == 'pull_request' || github.event_name == 'workflow_dispatch') &&
          github.ref != 'refs/heads/main'
        shell: bash
        run: echo "BRANCH_NAME=$(echo ${{ github.event.workflow_run.head_branch }} | tr [:upper:] [:lower:] | tr /_ - | cut -d "-" -f 2-3)" >> $GITHUB_ENV

      - name: Debug
        id: debug
        run: echo  "BRANCH_RPS_NAME=${{ env.BRANCH_NAME }}" >> $GITHUB_OUTPUT
